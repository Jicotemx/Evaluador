<!DOCTYPE html>
<html lang="es">
<head>
  <script src="https://cdn.socket.io/4.4.1/socket.io.min.js"></script>
  <meta charset="UTF-8">
  <title>Evaluador num√©rico üßÆ</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    body {
      background: linear-gradient(135deg, #1a2a6c, #b21f1f, #1a2a6c);
      color: #333;
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .card {
      background-color: rgba(255, 255, 255, 0.92);
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      padding: 30px;
      margin-bottom: 30px;
      position: relative;
      overflow: hidden;
    }
    
    .card::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 5px;
      background: linear-gradient(90deg, #4facfe, #00f2fe);
    }
    
    h1, h2, h3 {
      color: #1a2a6c;
      margin-bottom: 20px;
      text-align: center;
    }
    
    h1 {
      font-size: 2.5rem;
      background: linear-gradient(90deg, #ff8a00, #e52e71);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 0 2px 4px rgba(0,0,0,0.1);
      margin-top: 10px;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #1a2a6c;
    }
    
    input, select, button {
      width: 100%;
      padding: 14px;
      border: 2px solid #ddd;
      border-radius: 8px;
      font-size: 16px;
      transition: all 0.3s;
    }
    
    input:focus, select:focus {
      border-color: #4facfe;
      outline: none;
      box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.3);
    }
    
    button {
      background: linear-gradient(90deg, #4facfe, #00f2fe);
      color: white;
      font-weight: bold;
      border: none;
      cursor: pointer;
      margin-top: 10px;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }
    
    button:active {
      transform: translateY(1px);
    }
    
    .disabled {
      opacity: 0.5;
      pointer-events: none;
      cursor: not-allowed;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      background: white;
      border-radius: 8px;
      overflow: hidden;
    }
    
    th, td {
      border: 1px solid #ddd;
      padding: 12px 15px;
      text-align: center;
    }
    
    th {
      background: linear-gradient(90deg, #4facfe, #00f2fe);
      color: white;
      font-weight: bold;
    }
    
    tr:nth-child(even) {
      background-color: #f8f9fa;
    }
    
    tr:hover {
      background-color: #e9f7fe;
    }
    
    .status-box {
      padding: 15px;
      border-radius: 8px;
      text-align: center;
      margin: 20px 0;
      font-weight: bold;
      background: rgba(255, 255, 255, 0.9);
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    
    .running {
      background: linear-gradient(90deg, #38ef7d, #11998e);
      color: white;
    }
    
    .before {
      background: linear-gradient(90deg, #ffb347, #ffcc33);
      color: white;
    }
    
    .after {
      background: linear-gradient(90deg, #ff416c, #ff4b2b);
      color: white;
    }
    
    .timer {
      font-size: 1.5rem;
      font-weight: bold;
      text-align: center;
      padding: 15px;
      border-radius: 8px;
      background: rgba(0, 0, 0, 0.1);
      margin: 20px 0;
      color: #1a2a6c;
    }
    
    .message {
      padding: 15px;
      margin: 15px 0;
      border-radius: 8px;
      text-align: center;
    }
    
    .success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    
    .error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    
    .admin-link {
      text-align: center;
      margin-top: 20px;
    }
    
    .admin-link a {
      color: #1a2a6c;
      font-weight: bold;
      text-decoration: none;
      padding: 10px 20px;
      background: rgba(255, 255, 255, 0.7);
      border-radius: 30px;
      transition: all 0.3s;
      display: inline-block;
    }
    
    .admin-link a:hover {
      background: white;
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }
    
    .logo {
      text-align: center;
      font-size: 4rem;
      margin: 20px 0;
      color: white;
      text-shadow: 0 2px 10px rgba(0,0,0,0.3);
    }
    
    .flex-container {
      display: flex;
      gap: 20px;
      margin-bottom: 20px;
    }
    
    .flex-container > div {
      flex: 1;
    }
    
    @media (max-width: 768px) {
      .flex-container {
        flex-direction: column;
      }
    }
  </style>
  <script>
    MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        displayMath: [['$$','$$'], ['\\[','\\]']],
        processEscapes: true,
        packages: {'[+]': ['ams']}
      },
      loader: { load: ['[tex]/ams'] },
      startup: {
        pageReady: () => {
          return MathJax.startup.defaultPageReady().then(() => {
            console.log('MathJax listo');
          });
        }
      }
    };
  </script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
</head>
<body>
  <div class="container">
    <div class="logo">üßÆ</div>
    <h1>Sistema de Evaluaci√≥n Num√©rica</h1>
    
    <div id="loginDiv" class="card">
      <h2>Acceso al Sistema</h2>
      <div class="form-group">
        <label for="loginName">Nombre de usuario:</label>
        <input type="text" id="loginName" placeholder="Ingresa tu nombre">
      </div>
      
      <div class="form-group">
        <label for="loginPassword">Contrase√±a:</label>
        <input type="password" id="loginPassword" placeholder="Ingresa tu contrase√±a">
      </div>
      
      <button onclick="login()">Entrar al sistema</button>
      <div id="loginMsg" class="message" aria-live="polite"></div>
      
      <hr style="margin: 20px 0; border-color: #eee;">
      
      <div class="admin-link">
        <p>¬øEres administrador? <a href="/admin">Acceder al Panel de Administraci√≥n</a></p> 
      </div>
    </div>

    <div id="mainDiv" class="card" style="display:none">
      <button id="logoutButton" class="logout-btn">Salir del sistema</button>
      
      <div class="flex-container">
        <div id="statusMsg" class="status-box running" aria-live="polite" style="font-weight: bold;">Concurso en curso</div>
        <div id="timer" class="timer" style="font-weight:bold">‚è±Ô∏è Transcurrido: 00:00:00 | ‚åõ Faltan: 02:00:00</div>
      </div>

      <form id="submitForm">
        <h2>Enviar respuesta</h2>
        
        <div class="form-group">
          <label for="submitName">Nombre:</label>
          <input type="text" id="submitName" readonly>
        </div>
        
        <div class="form-group">
          <label for="problemSelect">Problema:</label>
          <select id="problemSelect" required onchange="mostrarEnunciado()">
            <option value="P1">Problema 1: Ecuaci√≥n cuadr√°tica</option>
            <option value="P2">Problema 2: Integral definida</option>
            <option value="P3">Problema 3: L√≠mite trigonom√©trico</option>
            <option value="P4">Problema 4: Matriz inversa</option>
          </select>
        </div>

        <div id="enunciado" class="form-group" style="margin:1em 0; padding: 20px; background: #f8f9fa; border-radius: 8px; font-size:18px;">
          <strong>Enunciado:</strong>
          <div>Resuelve la ecuaci√≥n cuadr√°tica: \( x^2 - 5x + 6 = 0 \)</div>
        </div>

        <div class="form-group">
          <label for="answerInput">Respuesta:</label>
          <input type="text" id="answerInput" required placeholder="Ingresa tu respuesta">
        </div>
        
        <button type="submit">Enviar respuesta</button>
        <div id="submitMsg" class="message" aria-live="polite"></div>
      </form>

      <h3>Tabla de posiciones</h3>
      <table id="rankingTable">
        <thead>
          <tr>
            <th>Participante</th>
            <th>P1</th>
            <th>P2</th>
            <th>P3</th>
            <th>P4</th>
            <th>Puntos</th>
            <th>Penalizaci√≥n</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Juan P√©rez</td>
            <td>‚úÖ (3)</td>
            <td>‚úÖ (2)</td>
            <td>‚ùå</td>
            <td>‚è≥</td>
            <td>25</td>
            <td>10</td>
          </tr>
          <tr>
            <td>Mar√≠a Garc√≠a</td>
            <td>‚úÖ (1)</td>
            <td>‚úÖ (1)</td>
            <td>‚úÖ (2)</td>
            <td>‚è≥</td>
            <td>35</td>
            <td>5</td>
          </tr>
          <tr>
            <td>Carlos L√≥pez</td>
            <td>‚úÖ (2)</td>
            <td>‚ùå</td>
            <td>‚úÖ (1)</td>
            <td>‚úÖ (3)</td>
            <td>30</td>
            <td>15</td>
          </tr>
        </tbody>
      </table>
      
      <div class="admin-link">
        <p><a href="/admin">Ir a Panel de Administraci√≥n</a></p>
      </div>
    </div>
  </div>

<script>
// Datos simulados para la demostraci√≥n
const problemasData = {
  "P1": {
    "enunciado": "Resuelve la ecuaci√≥n cuadr√°tica: \( x^2 - 5x + 6 = 0 \). Encuentra las ra√≠ces y proporciona la suma de ellas.",
    "respuesta": "5"
  },
  "P2": {
    "enunciado": "Calcula la integral definida: \( \int_{0}^{\pi} \sin(x) \, dx \).",
    "respuesta": "2"
  },
  "P3": {
    "enunciado": "Eval√∫a el l√≠mite: \( \lim_{x \to 0} \frac{\sin(3x)}{x} \).",
    "respuesta": "3"
  },
  "P4": {
    "enunciado": "Dada la matriz \( A = \begin{bmatrix} 2 & 1 \\ 1 & 2 \end{bmatrix} \), encuentra el determinante de su inversa.",
    "respuesta": "0.333"
  }
};

let startTime = new Date();
let durationSeconds = 7200; // 2 horas
let concursoStatus = "running";

// Variables para controlar la renderizaci√≥n de MathJax y el enunciado
let currentProblemId = null;
let currentEnunciadoHtml = null;

// Funci√≥n para simular el login
function login() {
  const name = document.getElementById("loginName").value.trim();
  const password = document.getElementById("loginPassword").value.trim();
  const loginMsgElem = document.getElementById("loginMsg");

  if (!name || !password) {
    loginMsgElem.textContent = "Debes ingresar nombre y contrase√±a.";
    loginMsgElem.className = "message error";
    return;
  }

  // Simular una petici√≥n al servidor
  setTimeout(() => {
    loginMsgElem.textContent = "¬°Acceso concedido! Cargando sistema...";
    loginMsgElem.className = "message success";
    
    setTimeout(() => {
      document.getElementById("loginDiv").style.display = "none";
      document.getElementById("mainDiv").style.display = "block";
      document.getElementById("submitName").value = name;
      iniciarConcurso();
    }, 1500);
  }, 1000);
}

// Funci√≥n de logout
function logout() {
  // Simular petici√≥n al servidor
  document.getElementById("mainDiv").style.display = "none";
  document.getElementById("loginDiv").style.display = "block";
  document.getElementById("loginName").value = "";
  document.getElementById("loginPassword").value = "";
  document.getElementById("loginMsg").textContent = "Has cerrado sesi√≥n correctamente.";
  document.getElementById("loginMsg").className = "message success";
}

// Registrar evento de logout cuando el DOM est√© cargado
document.addEventListener("DOMContentLoaded", () => {
  // Registrar logout si el bot√≥n existe
  const logoutButton = document.getElementById("logoutButton");
  if (logoutButton) {
    logoutButton.addEventListener("click", logout);
  }
});

function iniciarConcurso() {
  updateTimer();
  mostrarEnunciado();
  setInterval(updateTimer, 1000);
}

// Funci√≥n mejorada para actualizar el temporizador
function updateTimer() {
    const now = new Date();
    const startTimeObj = new Date(startTime);
    const endTime = new Date(startTimeObj.getTime() + durationSeconds * 1000);

    const timerElem = document.getElementById("timer");
    const form = document.getElementById("submitForm");
    const answerInput = document.getElementById("answerInput");
    const submitButton = form ? form.querySelector("button[type=submit]") : null;
    const statusMsg = document.getElementById("statusMsg");

    if (!timerElem || !form || !answerInput || !submitButton || !statusMsg) return;

    let newConcursoStatus;
    if (now < startTimeObj) {
        newConcursoStatus = "before";
        const diff = Math.floor((startTimeObj - now) / 1000);
        timerElem.textContent = `Comienza en: ${secondsToHMS(diff)}`;
        statusMsg.textContent = "El concurso comenzar√° pronto.";
        statusMsg.className = "status-box before";
        answerInput.disabled = true;
        submitButton.disabled = true;
    } else if (now < endTime) {
        newConcursoStatus = "running";
        const elapsed = Math.floor((now - startTimeObj) / 1000);
        const remaining = durationSeconds - elapsed;
        timerElem.textContent = `‚è±Ô∏è Transcurrido: ${secondsToHMS(elapsed)} | ‚åõ Faltan: ${secondsToHMS(remaining)}`;
        statusMsg.textContent = "Concurso en curso";
        statusMsg.className = "status-box running";
        answerInput.disabled = false;
        submitButton.disabled = false;
    } else {
        newConcursoStatus = "after";
        timerElem.textContent = "Concurso finalizado.";
        statusMsg.textContent = "Concurso finalizado.";
        statusMsg.className = "status-box after";
        answerInput.disabled = true;
        submitButton.disabled = true;
    }

    window.concursoStatus = newConcursoStatus;
}

function secondsToHMS(s) {
  const h = Math.floor(s/3600), m = Math.floor((s%3600)/60), sec = s%60;
  return `${h.toString().padStart(2,"0")}:${m.toString().padStart(2,"0")}:${sec.toString().padStart(2,"0")}`;
}

document.getElementById("submitForm").onsubmit = e => {
  e.preventDefault();
  const name = document.getElementById("submitName").value.trim();
  const pid = document.getElementById("problemSelect").value;
  const ans = document.getElementById("answerInput").value.trim();
  const submitMsgElem = document.getElementById("submitMsg");

  if (ans === "") {
      submitMsgElem.textContent = "La respuesta no puede estar vac√≠a.";
      submitMsgElem.className = "message error";
      return;
  }

  // Simular env√≠o al servidor
  submitMsgElem.textContent = `Respuesta para el problema ${pid} enviada: ${ans}`;
  submitMsgElem.className = "message success";
  
  // Limpiar campo de respuesta
  document.getElementById("answerInput").value = '';
};

// Funci√≥n modificada para mostrar el enunciado
function mostrarEnunciado() {
    const pid = document.getElementById("problemSelect").value;
    const enunciadoDiv = document.getElementById("enunciado");
    
    if (!problemasData[pid]) {
        enunciadoDiv.innerHTML = "<em>Problema no encontrado.</em>";
        return;
    }
    
    enunciadoDiv.innerHTML = `
        <strong>Enunciado:</strong>
        <div id="math-content">${problemasData[pid].enunciado}</div>
    `;
    
    // Simular renderizado de MathJax
    const mathContentContainer = document.getElementById("math-content");
    if (mathContentContainer && typeof MathJax !== 'undefined') {
        setTimeout(() => {
            MathJax.typesetClear([mathContentContainer]);
            MathJax.typesetPromise([mathContentContainer]);
        }, 100);
    }
}
</script>

</body>
</html>
