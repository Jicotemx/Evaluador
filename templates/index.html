<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Evaluador ICPC</title>
  <style>
    .disabled { opacity: 0.5; pointer-events: none; }
    table, th, td { border: 1px solid black; border-collapse: collapse; padding: 4px; }
  </style>

  <!-- MathJax para mostrar LaTeX -->
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async
          src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>

<h1>Evaluador Concurso</h1>

<!-- Estado y temporizador -->
<div>
  <div id="statusMsg"></div>
  <div id="timer" style="font-weight: bold;"></div>
</div>

<!-- Registro -->
<div id="registrationDiv">
  <h2>Regístrate</h2>
  <input type="text" id="nameInput" placeholder="Tu nombre" />
  <button id="registerBtn">Registrar</button>
  <div id="registerMsg"></div>
</div>

<!-- Lista de participantes -->
<h3>Participantes</h3>
<ul id="participantsList"></ul>

<!-- Formulario de envío -->
<form id="submitForm" class="disabled">
  <h2>Enviar respuesta</h2>

  <label>Nombre:</label>
  <input type="text" id="submitName" required /><br/>

  <label>Problema:</label>
  <select id="problemSelect" required onchange="mostrarEnunciado()">
    {% for pid in problems %}
      <option value="{{ pid }}">{{ pid }}</option>
    {% endfor %}
  </select><br/>

  <div id="enunciado" style="margin: 1em 0; font-size: 18px;"></div>

  <label>Respuesta:</label>
  <input type="text" id="answerInput" required /><br/>

  <button type="submit">Enviar</button>
  <div id="submitMsg"></div>
</form>

<!-- Tabla de posiciones -->
<h3>Tabla de posiciones</h3>
<table id="rankingTable">
  <thead>
    <tr>
      <th>Participante</th>
      {% for pid in problems %}
        <th>{{ pid }}</th>
      {% endfor %}
      <th>Puntos</th>
      <th>Penalización</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<!-- Scripts -->
<script>
const startTime = new Date("{{ start_time_iso }}");
const durationSeconds = {{ duration }};

// Enunciados desde Flask
const enunciados = {
  {% for pid, data in problems.items() %}
    "{{ pid }}": `{{ data["enunciado"] }}`,
  {% endfor %}
};

// Mostrar enunciado con MathJax
function mostrarEnunciado() {
  const pid = document.getElementById("problemSelect").value;
  document.getElementById("enunciado").innerHTML = enunciados[pid];
  MathJax.typeset();
}

function secondsToHMS(seconds) {
  const h = Math.floor(seconds / 3600);
  const m = Math.floor((seconds % 3600) / 60);
  const s = seconds % 60;
  return `${h.toString().padStart(2,"0")}:${m.toString().padStart(2,"0")}:
